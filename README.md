# Дипломный проект Foodgram
## _Соц сеть для обмена рецептами._
## Foodgram - это приложение на Django Rest Framework. С помощью данного API вы сможете воспользоваться всеми возможностями приложения.

# Запуск проекта на удаленном сервере

## В проекте реализовано автоматическое размещение приложения на удаленном сервере в контейнерах.

В .github/workflow/main.yml описана инструкция для Github Actions.

Она начинает автоматическое тестирование и развертывание приложения после пуша в ветку "master". 

## Что нужно сделать, чтобы проект заработал

Сделайте форк репозитория в свой аккаунт на гитхабе.

Клонируйте проект себе в рабочую директорию:

```
git clone git@github.com:username/foodgram-project-react.git
```

## На удаленном сервере создайте директорию проекта и скопируйте туда директории docs и data

На локальном компьютере в командной строке перейдите в директорию проекта и выполните следующую команду. Подставьте свой путь до SSH файла с закрытым ключом. 
```
scp -r -i path_to_SSH/SSH_name data/* username@server_ip:/home/username/foodgram/data/
```
Повторите для docs.

## Создайте файл с переменными окружения в корне репозитория.

В файле .env-sample даны названия переменных, которым нужно задать значения для корректной работы PostgreSQL и Django.

## Создайте секретные переменные в Github Actions.

В файле .github/workflow/main.yml есть секретные переменные, например:

```
username: ${{ secrets.DOCKER_USERNAME }}
```

1. На гитхабе перейдите в раздел settings репозитория
2. Найдите раздел Secrets and variables/Actions
3. Создайте секреты:
- DOCKER_USERNAME - username на Docker Hub
- DOCKER_PASSWORD - пароль от Docker Hub
- HOST - ip адрес удаленного сервера
- USER - username на удаленном сервере
- SSH_KEY - содержимое закрытого SSH ключа
- SSH_PASSPHRASE - пароль от SSH ключа
- TELEGRAM_TO - id в телеграме, кому отправить сообщение об успешном деплое
- TELEGRAM_TOKEN - токен вашего бота в телеграме

## Автоматический деплой

После внесения всех изменений на компьютере и гитхабе запуште проект:

```
git add .
git commit -m 'First deploy!'
git push
```

## Наблюдайте магию

Перейдите в раздел Actions на гитхабе и следите за процессом.

При возникновении ошибок исправьте их и повторите пуш снова.
___

## На удаленном сервере установите Nginx

```
sudo apt install nginx -y
```

## Внесите изменения в настройки Nginx

Выполните команду

```
sudo nano /etc/nginx/sites-enabled/default
```

Удалите все из файла и добавьте эти настройки:

```
server {
    listen 80;
    server_name ip_вашего_удаленного_сервера;

    location / {
        proxy_pass http:/127.0.0.1:9000;
    }

}
```
## Запустите Nginx

Проверьте правильность конфигурации и запустите процесс

```
sudo nginx -t
sudo systemctl start nginx
```
___
### Проект должен быть доступен по ip адресу удаленного сервера.

# Запуск проекта на локальном компьютере
Сделайте форк репозитория в свой аккаунт на гитхабе.

Клонируйте проект себе в рабочую директорию:

```
git clone git@github.com:username/foodgram-project-react.git
```

## Запуск бэкэнда
1. Создайте файл с переменными окружения.

В файле .env-sample даны названия переменных, которым нужно задать значения для корректной работы PostgreSQL и Django.

2. Перейдите в директорию backend
```
cd backend/
```

3. Создайте и активируйте виртуальное окружение.
```
python -m venv venv
source venv/Scripts/activate
```

4. Обновите pip и установите зависимости.
```
python -m pip install --update pip
pip install -r requirements.txt
```

5. Выполните миграции и наполните базу данных ингредиентами.
```
python manage.py migrate
python manage.py csv_to_database
```

6. Запустите сервер.
```
python manage.py runserver
```

# Документация API
Документация к API запускается через Docker.

1. Установите и запустите Docker на своем компьютер.

2. В директории проекта выполните следующие шаги:

Перейдите в папку infra запустите образ фронтенда.
```
cd ../infra/
docker compose up
```

При выполнении этой команды сервис frontend, описанный в docker-compose.yml подготовит файлы, необходимые для работы фронтенд-приложения, а затем прекратит свою работу.

## Проект запустится на адресе http://localhost
## Спецификация API доступна по адресу http://localhost/api/docs/

